<!DOCTYPE html>
<html>
<head>
    <title>Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        #lineChart {
            display: block;
            margin: 30px auto 0 auto;
            background: #f8f9fa;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.07);
            padding: 20px;
            width: 90vw;
            max-width: 1200px;
            height: 400px;
        }
    </style>
</head>
<body>
    <h1>Dashboard</h1>

    <p><strong>Total images uploadées :</strong> {{ total }}</p>
    <p><strong>Pleines :</strong> {{ full }}</p>
    <p><strong>Vides :</strong> {{ empty }}</p>

    <h2>Graphiques statistiques</h2>
    <img src="data:image/png;base64,{{ pie_chart }}" alt="Pie Chart">
    <img src="data:image/png;base64,{{ hist_chart }}" alt="Histogram">

    <h2>Graphiques dynamiques des dates des images</h2>
    <canvas id="lineChart" width="400" height="200"></canvas>

    <script>
        const dates = {{ dates | tojson }};
        const dateCounts = {};

        dates.forEach(date => {
            if (typeof date === 'string' && date.length === 10) {
                dateCounts[date] = (dateCounts[date] || 0) + 1;
            }
        });

        // Trie les dates dans l'ordre chronologique
        const labels = Object.keys(dateCounts).sort();
        const data = labels.map(date => dateCounts[date]);

        if (labels.length > 0) {
            new Chart(document.getElementById('lineChart'), {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Images uploadées par jour',
                        data: data,
                        borderColor: 'rgb(75, 192, 192)',
                        backgroundColor: 'rgba(75, 192, 192, 0.15)',
                        pointBackgroundColor: 'rgb(75, 192, 192)',
                        pointRadius: 6,
                        pointHoverRadius: 9,
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { display: false },
                        title: {
                            display: true,
                            text: 'Évolution des uploads par date',
                            font: { size: 18 }
                        }
                    },
                    scales: {
                        x: {
                            title: { display: true, text: 'Date', font: { size: 15 } },
                            grid: { color: '#e0e0e0' }
                        },
                        y: {
                            title: { display: true, text: "Nombre d'images", font: { size: 15 } },
                            beginAtZero: true,
                            grid: { color: '#e0e0e0' },
                            ticks: { stepSize: 1 }
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>
